# AWS 入門

- AWS サービス一覧

  - VPC & サブネット

    AWS 上にネットワークを用意するやつが VPC(Vertual Private Cloud)、そしてそれを細かな区分に分けるものがサブネットということ。
    どんな web アプリケーションをするにしても必要

  - IAM(アイアム) (Identification Access Management)

    権限を管理するやつ。このアカウントにどんな動作を許可するかとか、そもそもユーザーを作ったり、グループを作ったりとかに必要。大事

  - S3

    Simple Strage Service: S3 巨大なファイル置き場
    よく使われるのは、静的なファイル群を置いたりする。ログの置き場にも使う。とってもお安い

  - EC2

    サーバーをたてるやつ。データベース用のサーバーとか web サーバーとか。このサーバーは VPC とサブネットで分けたところにつくる。

  - ELB

    ロードバランサーを立てるやつ。負荷を分散するためのやつ。
    サーバーの前段にロードバランサーを置いておくことで、うまく負荷を分散してサーバーが落ちるのを防ぐ。
    NLB:Network Load Balancing ,ALB: Application Load Balancing の２つがある。この２つを総称して ELB(エラスティックロードバランシング)

  - ECS(+FARGATE)

    Docker コンテナを動かすやつ。Docker を動かすには、自分の PC か、サーバーとか必ず計算資源が必要なので、それを AWS でうまくしてもらう。

- 基本ネットワーク構成
  VPC: 仮想のネットワーク領域（サブネットマスクのサイダー表記で分割する）VPC を作ったなかに必ずサブネットで切る必要がある。

  - パブリックサブネット: インターネットから入れるし出れる
  - プライベートサブネット: インターネットに出れる

  IGW: Internet Gate Way 外のインターネットと通信できる。

  パブリックサブネットのデフォルトゲートウェイ(DGW)を VPC 全体の IGW にしておく

  ルートテーブル： プライベートサブネット用、パブリックサブネット用などそれぞれの用途ごとに、サブネットを指定してルーティングを管理する。

  プライベートサブネットから外部に出ようとすると、NAT ゲートウェイを通じて IGW を通って外に出る。（プライベートサブネットは言語の導入とか、もろもろのためにどうしても外部と通信する必要があるため必要。）

- AZ アベイラビリティゾーン

- AWS Lambda

  ガチガチのアプリではない。
  AWS S3 のイベントをトリガーにするとか、まぁそのようなもの

- S3

  Simple Strage Service: S3

  料金は安い（容量はかなり大きい）
  単位はバケットという。
  ファイルのディレクトリという概念はいちおうない。でも、実態としてはほとんど同じように使える。パスではなく、キーといったり、ファイルのことをオブジェクトといったりするけど、あんまりファイル置き場といって誤解はない。

- ロードバランサー

  大量のアクセスを受け付けるためのもの

  Load Balancer: LB
  ロードバランサーにエンドポイント（URL の先）が置いてあり、それを適切に各サーバーに振り分ける。（このときに LB は、各サーバーに対して大丈夫かどうかヘルスチェックを行う。）また、ロードバランサーは冗長性を上昇させる。

  また、もう一つの利点として https の SSL 証明書の導入を各サーバーに行う必要がなくロードバランサーのみでよい。

- IAM について

  - グループ

    同じ権限を複数のユーザーに与えるときは、いちいち各ユーザーに与えるのは面倒なので、ユーザーをまとめて、グループ単位で権限で与える。

  - ポリシー

    IAM におけるルールはすべて JSON 形式で保存されている。ポリシーは、各ユーザーが何ができるのか、とかそういうことが記述されている。
    グループ、ユーザー、ロールに各自に必要な権限を与える。

  - ユーザー

    アカウントとほぼ同義。`ポリシーによってユーザー1に権限をアタッチする`とかいう。ファイルを S3 にアップロードするのも、EC2 でサーバーを立てる権限を与えたりする。（そのため AWS の管理画面はだれもが使えるわけではない。）

  - ロール

    AWS ラムダ(lambda)とか、S3 とか、EC2 とか、そういうものを他のサービスからアクセスする権限

    すなわち、AWS 内部もしくは外部のサービスから AWS のあるサービスにアクセスするときにアクセスできる権限のこと（これがないと、外部からアクセスし放題になってしまうので...）

# サーバーレス

- 何が良いのか

  サーバーのあらゆる運用がいらない。また、自動でスケールしてくれる。料金は使った分だけ
  (すなわち、ハードウェアを買う必要はないし、使う言語とかもろもろをインストールする必要がない。また、使っている言語のパッチに対してアップデートとかを自分でしなくてよい。)(あとは、冗長性を確保するために、ロードバランサーとかを使って考えなくてはいけないが、それをある程度勝手にやってくれる。)(つまり、管理コストはかからない。)

- 何がよくないのか

  サービスに依存する。自由度は下がる。

具体的には、AWS Lambda, GCP(Google Cloud Platform)

サーバーレスには Faas と Caas がある。
Function as a Service : コードを書くだけで実行できる。
Container as a Service: Docker を起動するためのサーバーとかはいらない。

# CI/CD

- CI/CD

  - CI: Continuous Integration 継続的なインティグレーション

    結局のところ、自動でテストとビルド（コンパイルがいっぱいあるやつ）をしてくれるということ

  - CD: Continuous Devployment 継続的なデプロイ

    自動で、AWS とか、本番環境にアップロードしてくれるよ！ということ

  - CI/CD: プログラムのテスト、ビルド、デプロイを自動化する。

    何がうれしいの？-> リリースに関するあらゆるミスが少なくなる。自分でもテストを書いたけど、確かにミスに気づける。（つまりミスが減る、あと単純に楽だからというのもある。）

GitHub (`main`) -> Circle CI -> リーリス先

AWS CodeBuild とかも CI/CD

なんで、CI/CD が流行っているのか？

CI/CD では、裏では、コンテナが起動している。そして Linux コマンドが実行される。(yaml ファイルというところにそのコンテナでして欲しいことを書いておく)

自分でも一から CI/CD を書いてみるべし
